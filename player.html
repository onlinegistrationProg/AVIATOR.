<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Aviator — Player</title>
<style>
  body {margin:0;background:#0d0d0f;color:#fff;font-family:Arial,Helvetica,sans-serif}
  .wrap{max-width:500px;margin:14px auto;padding:12px}
  h2{color:#ff3344}
  .panel{background:#111;padding:12px;border-radius:10px;margin-top:12px}
  input, button {padding:8px;border-radius:6px;border:none;margin:4px 0;width:100%;}
  button{cursor:pointer;color:#fff;}
  .green{background:#25b24a;}
  .red{background:#ff5555;}
  #multiplierDisplay{font-size:24px;font-weight:bold;margin:10px 0;}
</style>
</head>
<body>
<div class="wrap">
  <h2>Aviator — Player Login</h2>

  <div class="panel" id="loginPanel">
    <input type="text" id="playerPhone" placeholder="Phone Number" autocomplete="username">
    <input type="password" id="playerPass" placeholder="Password" autocomplete="current-password">
    <button id="loginBtn">Login / Register</button>
  </div>

  <div class="panel" id="playerPanel" style="display:none;">
    <h3>Welcome, <span id="playerName"></span></h3>
    <p>Balance: $<span id="balanceDisplay">0</span></p>

    <div class="panel">
      <h4>Deposit Request</h4>
      <input type="number" id="depositAmt" placeholder="Amount to deposit">
      <button id="requestDeposit" class="green">Request Deposit</button>
      <p style="font-size:12px;">Deposits will reflect after admin approval.</p>
    </div>

    <div class="panel">
      <h4>Place Stake</h4>
      <input type="number" id="stakeAmt" placeholder="Amount to stake">
      <button id="startRound" class="green">Start Round</button>
      <p id="multiplierDisplay">Multiplier: 1.00x</p>
      <button id="cashOut" class="green" style="display:none;">Cash Out</button>
    </div>

    <div class="panel">
      <h4>Past Multipliers</h4>
      <textarea id="pastMults" rows="5" readonly style="width:100%;background:#222;color:#fff;"></textarea>
    </div>

    <button id="logoutBtn" class="red">Logout</button>
  </div>
</div>

<script>
let currentPlayer = null;
let currentStake = 0;
let currentMultiplier = 1;
let multiplierInterval = null;

// LOGIN / REGISTER
document.getElementById('loginBtn').addEventListener('click', ()=>{
  const phone = document.getElementById('playerPhone').value.trim();
  const pass = document.getElementById('playerPass').value;
  if(!phone||!pass) return alert('Enter phone and password');
  const users = JSON.parse(localStorage.getItem('aviator_users')||'{}');
  if(users[phone]){
    if(users[phone].password!==pass) return alert('Incorrect password');
  } else {
    users[phone] = {password:pass, balance:0};
    localStorage.setItem('aviator_users', JSON.stringify(users));
  }
  currentPlayer = phone;
  document.getElementById('loginPanel').style.display='none';
  document.getElementById('playerPanel').style.display='block';
  document.getElementById('playerName').textContent = currentPlayer;
  updateBalance();
  loadPastMultipliers();
});

// LOGOUT
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  currentPlayer = null;
  stopRound();
  document.getElementById('loginPanel').style.display='block';
  document.getElementById('playerPanel').style.display='none';
});

// UPDATE BALANCE
function updateBalance(){
  const users = JSON.parse(localStorage.getItem('aviator_users')||'{}');
  document.getElementById('balanceDisplay').textContent = users[currentPlayer]?.balance||0;
}

// DEPOSIT REQUEST
document.getElementById('requestDeposit').addEventListener('click', ()=>{
  const amt = Number(document.getElementById('depositAmt').value);
  if(!amt) return alert('Enter amount');
  const deposits = JSON.parse(localStorage.getItem('aviator_deposits')||'[]');
  deposits.push({phone:currentPlayer, amount:amt, note:'player request'});
  localStorage.setItem('aviator_deposits', JSON.stringify(deposits));
  alert('Deposit requested. Wait for admin approval.');
  document.getElementById('depositAmt').value='';
});

// LOAD PAST MULTIPLIERS
function loadPastMultipliers(){
  const key = 'aviator_rounds_'+new Date().toISOString().slice(0,10);
  const rounds = JSON.parse(localStorage.getItem(key)||'[]');
  document.getElementById('pastMults').value = rounds.join(',');
}

// START ROUND with smooth multiplier
document.getElementById('startRound').addEventListener('click', ()=>{
  const amt = Number(document.getElementById('stakeAmt').value);
  if(!amt) return alert('Enter stake amount');
  const users = JSON.parse(localStorage.getItem('aviator_users')||'{}');
  if(users[currentPlayer].balance < amt) return alert('Insufficient balance');

  users[currentPlayer].balance -= amt;
  localStorage.setItem('aviator_users', JSON.stringify(users));
  updateBalance();

  currentStake = amt;
  currentMultiplier = 1;
  document.getElementById('cashOut').style.display='inline-block';

  const key = 'aviator_rounds_'+new Date().toISOString().slice(0,10);
  const rounds = JSON.parse(localStorage.getItem(key)||'[]');
  let idx = 0;
  let lastVal = 1;

  multiplierInterval = setInterval(()=>{
    if(idx >= rounds.length){
      alert('Round ended! You did not cash out. Stake lost.');
      stopRound();
      return;
    }
    const target = rounds[idx];
    let step = (target-lastVal)/20;
    let count = 0;
    const smoothInterval = setInterval(()=>{
      lastVal += step;
      document.getElementById('multiplierDisplay').textContent = 'Multiplier: '+lastVal.toFixed(2)+'x';
      count++;
      if(count>=20){
        clearInterval(smoothInterval);
        lastVal = target;
        idx++;
      }
    }, 50);
  }, 1000);
});

// CASH OUT
document.getElementById('cashOut').addEventListener('click', ()=>{
  const users = JSON.parse(localStorage.getItem('aviator_users')||'{}');
  const won = currentStake*currentMultiplier;
  users[currentPlayer].balance += parseFloat(won.toFixed(2));
  localStorage.setItem('aviator_users', JSON.stringify(users));
  alert('Cashed out: $'+won.toFixed(2));
  updateBalance();
  stopRound();
});

function stopRound(){
  currentStake = 0;
  currentMultiplier = 1;
  document.getElementById('multiplierDisplay').textContent = 'Multiplier: 1.00x';
  document.getElementById('cashOut').style.display='none';
  if(multiplierInterval) clearInterval(multiplierInterval);
  multiplierInterval = null;
}
</script>
</body>
</html>
