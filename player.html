<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aviator â€” Player</title>
<style>
  :root{--bg:#0d0d0f;--panel:#111;--muted:#777;--accent:#ff3344;--green:#25b24a}
  body{margin:0;background:var(--bg);color:#fff;font-family:Arial,Helvetica,sans-serif;min-height:100vh}
  .wrap{max-width:420px;margin:12px auto;padding:10px}
  header{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:#0f0f12;border-radius:8px}
  .logo{font-weight:700;color:var(--accent)}
  .balance{color:#2fdf5a;font-weight:700}
  .game{background:linear-gradient(180deg,#0c0c0d,#141416);border-radius:12px;padding:12px;margin-top:12px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
  .big-mult{font-size:64px;text-align:center;margin:6px 0;font-weight:800}
  .plane{height:10px;background:linear-gradient(90deg,#ff3344,#ff6b6b);border-radius:8px;margin-bottom:8px}
  .controls{display:flex;gap:12px;margin-top:12px;align-items:center;justify-content:space-between}
  .betbox{flex:1;background:var(--panel);padding:12px;border-radius:10px}
  .btn{padding:14px 18px;border-radius:10px;border:none;cursor:pointer}
  .green{background:var(--green);color:#fff;font-weight:700}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px}
  .bets-list{margin-top:12px;background:var(--panel);padding:10px;border-radius:10px}
  .row{display:flex;gap:8px;align-items:center}
  .pill{background:#1b1b1d;padding:8px 12px;border-radius:999px}
  .center{text-align:center}
  footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
  .result-history{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .hist-item{background:#111;padding:6px 8px;border-radius:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">Aviator</div>
    <div class="balance" id="balTxt">0.00 KES</div>
  </header>

  <div class="game" id="gameArea">
    <div class="plane"></div>
    <div class="center"><div class="big-mult" id="multiplier">--</div></div>
    <div class="center muted" id="modeTag">FUN MODE</div>

    <div class="bets-list">
      <div class="row">
        <div class="betbox">
          <div class="row" style="justify-content:space-between">
            <div class="small muted">Bet</div>
            <div class="small muted">Auto</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;margin-top:8px">
            <button class="pill" id="dec">-</button>
            <div id="betAmount" style="min-width:70px;text-align:center">10.00</div>
            <button class="pill" id="inc">+</button>
            <div style="flex:1"></div>
            <button id="placeBtn" class="btn green">Bet<br><span id="btnAmount">10.00 KES</span></button>
          </div>
          <div style="display:flex;gap:8px;margin-top:12px">
            <div class="pill small">100</div>
            <div class="pill small">200</div>
            <div class="pill small">500</div>
            <div class="pill small">10000</div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="muted small">All Bets</div>
        <div style="height:6px"></div>
        <div id="betsPlaced"></div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="muted small">Rounds (today)</div>
      <div class="result-history" id="roundsPreview"></div>
    </div>
  </div>

  <footer>We keep your data secure and confidential.</footer>
</div>

<script>
/* ====== Core logic implementing the requested features ======
 - login via localStorage
 - daily deterministic rounds (same for all players) saved by date
 - round results generation ensures uniqueness per day (no duplicates)
 - placing bets, auto cashout not fully complex but supports placing and immediate resolution when round advances
 - admin deposit approval will add to user balance (admin.html)
 - auto update multiplier simulation: rounds progress every 7s (demo speed) but deterministic
 - multipliers sequence won't repeat (unique within day's sequence)
============================================================*/

const userKey = localStorage.getItem('aviator_current')
if(!userKey){location.href='login.html'}
const users = JSON.parse(localStorage.getItem('aviator_users')||'{}')
const me = users[userKey] || {balance:0,displayName:userKey}
const balanceElem = document.getElementById('balTxt')
const multiplierElem = document.getElementById('multiplier')
const roundsPreview = document.getElementById('roundsPreview')
const betsPlaced = document.getElementById('betsPlaced')

function fmt(n){return Number(n).toFixed(2)+' KES'}
function saveUsers(){localStorage.setItem('aviator_users', JSON.stringify(users))}

balanceElem.textContent = fmt(me.balance||0)

// --- Daily deterministic rounds ---
function getTodayKey(){
  const d = new Date(); return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate()
}
function generateTodaysRounds(){
  const key = 'aviator_rounds_'+getTodayKey()
  let rounds = JSON.parse(localStorage.getItem(key)||'null')
  if(rounds) return rounds
  // create unique multipliers for the day
  const N = 720 // number of rounds per day
  const set = new Set()
  const arr = []
  let seed = Number(getTodayKey().split('-').join('')) + 12345
  function rnd(){ seed = (seed * 9301 + 49297) % 233280; return seed/233280 }
  while(arr.length < N){
    // sample multiplier 1.05 - 25.00 (skewed)
    const x = Math.max(1.01, (1 + Math.pow(rnd(),1.8)*24).toFixed(2))
    // ensure uniqueness up to 2 decimals; if collision, try again
    if(!set.has(x)){
      set.add(x); arr.push(Number(x))
    }
  }
  localStorage.setItem(key, JSON.stringify(arr))
  return arr
}
const todaysRounds = generateTodaysRounds()
function renderRoundsPreview(){
  roundsPreview.innerHTML = ''
  for(let i=0;i<12;i++){
    const s=document.createElement('div');s.className='hist-item';s.textContent=todaysRounds[i]+'x'; roundsPreview.appendChild(s)
  }
}
renderRoundsPreview()

// --- Round progression & UI ---
let roundIndex = 0
let tickInterval = 7000 // 7s per round for demo (adjust as needed)
let currentPhase = 'idle' // 'running' or 'idle'
let placedBets = []

function startRounds(){
  updateRound()
  window._roundTimer = setInterval(()=> {
    advanceRound()
  }, tickInterval)
}
function updateRound(){
  const val = todaysRounds[roundIndex]
  multiplierElem.textContent = val + 'x'
  document.getElementById('modeTag').textContent = 'FUN MODE'
  renderBets()
}
function advanceRound(){
  // resolve bets for this round automatically: anyone with bet placed before advance wins at that round's multiplier
  const val = todaysRounds[roundIndex]
  // resolve bets
  placedBets.forEach(b=>{
    if(!b.resolved){
      b.resolved=true
      if(val >= b.cashoutMultiplier){
        // win
        const win = b.amount * b.cashoutMultiplier
        users[userKey].balance = (users[userKey].balance||0) + win
      } else {
        // lost: bet already deducted on place
      }
    }
  })
  saveUsers()
  // update display after resolution
  balanceElem.textContent = fmt(users[userKey].balance||0)
  // advance index
  roundIndex = (roundIndex + 1) % todaysRounds.length
  updateRound()
  renderRoundsPreview()
}

// --- Betting UI ---
let betAmount = 10.00
const betAmountElem = document.getElementById('betAmount')
const btnAmount = document.getElementById('btnAmount')
function refreshBetUI(){
  betAmountElem.textContent = Number(betAmount).toFixed(2)
  btnAmount.textContent = Number(betAmount).toFixed(2)+' KES'
}
refreshBetUI()
document.getElementById('inc').addEventListener('click', ()=>{ betAmount = Math.min(100000, betAmount+10); refreshBetUI() })
document.getElementById('dec').addEventListener('click', ()=>{ betAmount = Math.max(1, betAmount-10); refreshBetUI() })

document.getElementById('placeBtn').addEventListener('click', ()=>{
  const bal = users[userKey].balance || 0
  if(bal < betAmount){ alert('Insufficient balance'); return }
  // deduct immediately
  users[userKey].balance = Math.max(0, bal - betAmount)
  saveUsers()
  balanceElem.textContent = fmt(users[userKey].balance||0)
  // place bet for next round and auto cashout at chosen multiplier (for simplicity default 2x)
  const bet = {id:Date.now()+Math.random(), amount:betAmount, placedAtRound:roundIndex, cashoutMultiplier:2.00, resolved:false}
  placedBets.push(bet)
  renderBets()
})

function renderBets(){
  betsPlaced.innerHTML = ''
  if(placedBets.length===0){ betsPlaced.innerHTML = '<div class="muted small">No active bets</div>'; return }
  placedBets.forEach(b=>{
    const e = document.createElement('div'); e.style.padding='8px'; e.style.marginBottom='6px'; e.style.background='#0f0f10'; e.style.borderRadius='8px'
    e.innerHTML = `<div style="display:flex;justify-content:space-between"><div>Bet ${b.amount.toFixed(2)} KES</div><div>${b.resolved? 'Settled': 'Active'}</div></div>
                   <div style="font-size:13px;color:#bbb">Cashout: ${b.cashoutMultiplier}x</div>`
    betsPlaced.appendChild(e)
  })
}

// start simulation
startRounds()

// make sure balance is saved periodically
setInterval(()=> saveUsers(), 5000)
</script>
</body>
</html>
