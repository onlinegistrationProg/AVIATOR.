<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#0d0d0f; color:#fff;}
header{background:#111; padding:10px; text-align:center; color:#ff0033; font-size:24px;}
.container{padding:20px;}
table{width:100%; border-collapse: collapse; margin-top:20px;}
th,td{border:1px solid #fff; padding:8px; text-align:center;}
th{background:#111;}
button{padding:5px 10px; margin:2px; border:none; border-radius:5px; cursor:pointer;}
.approve{background:#00ff33;}
.block{background:#ff0033;}
.logout{background:#ff0033; color:#fff; margin-top:20px; padding:10px 20px;}
</style>
</head>
<body>
<header>Admin Panel</header>
<div class="container">

<h2>Players</h2>
<table id="playersTable">
  <tr>
    <th>Phone</th><th>Password</th><th>Balance</th><th>Blocked</th><th>Actions</th>
  </tr>
</table>

<h2>Deposit Requests</h2>
<table id="depositsTable">
  <tr>
    <th>Phone</th><th>Amount</th><th>Status</th><th>Action</th>
  </tr>
</table>

<h2>Daily Rounds</h2>
<table id="roundsTable">
  <tr>
    <th>Round</th><th>Crash ×</th><th>Start Time</th><th>Player Stakes</th>
  </tr>
</table>

<button class="logout" onclick="logout()">Logout</button>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players") || "[]");
let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
let rounds = JSON.parse(localStorage.getItem("dailyRounds") || "[]");

function renderPlayers() {
  const table = document.getElementById("playersTable");
  table.innerHTML = `<tr><th>Phone</th><th>Password</th><th>Balance</th><th>Blocked</th><th>Actions</th></tr>`;
  players.forEach((p, i) => {
    let row = table.insertRow();
    row.insertCell(0).textContent = p.phone;
    row.insertCell(1).textContent = p.password;
    row.insertCell(2).textContent = p.balance.toFixed(2);
    row.insertCell(3).textContent = p.blocked ? "Yes" : "No";
    let actions = row.insertCell(4);
    let blockBtn = document.createElement("button");
    blockBtn.textContent = p.blocked ? "Unblock" : "Block";
    blockBtn.className = "block";
    blockBtn.onclick = () => toggleBlock(i);
    actions.appendChild(blockBtn);
  });
}

function toggleBlock(i) {
  players[i].blocked = !players[i].blocked;
  localStorage.setItem("players", JSON.stringify(players));
  renderPlayers();
}

function renderDeposits() {
  const table = document.getElementById("depositsTable");
  table.innerHTML = `<tr><th>Phone</th><th>Amount</th><th>Status</th><th>Action</th></tr>`;
  deposits.forEach((d,i)=>{
    let row = table.insertRow();
    row.insertCell(0).textContent=d.phone;
    row.insertCell(1).textContent=d.amount;
    row.insertCell(2).textContent=d.status;
    let actionCell = row.insertCell(3);
    if(d.status==="pending") {
      let approveBtn=document.createElement("button");
      approveBtn.textContent="Approve";
      approveBtn.className="approve";
      approveBtn.onclick = ()=> approveDeposit(i);
      actionCell.appendChild(approveBtn);
    } else { actionCell.textContent="-"; }
  });
}

function approveDeposit(i) {
  deposits[i].status="approved";
  let playerIndex = players.findIndex(p=>p.phone===deposits[i].phone);
  if(playerIndex>-1) players[playerIndex].balance += deposits[i].amount;
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("deposits", JSON.stringify(deposits));
  renderPlayers();
  renderDeposits();
}

function renderRounds() {
  const table = document.getElementById("roundsTable");
  table.innerHTML = `<tr><th>Round</th><th>Crash ×</th><th>Start Time</th><th>Player Stakes</th></tr>`;
  rounds.forEach(r=>{
    let row = table.insertRow();
    row.insertCell(0).textContent = r.round;
    row.insertCell(1).textContent = r.crash;
    row.insertCell(2).textContent = r.startTime;
    let stakes = r.stakes.map(s=>`${s.phone}: ${s.amount} (${s.cashedOut===false?"lost":"cashed"})`).join(", ");
    row.insertCell(3).textContent = stakes;
  });
}

function logout() {
  localStorage.removeItem("loggedIn");
  window.location.href="index.html";
}

renderPlayers();
renderDeposits();
renderRounds();
</script>
</body>
</html>
